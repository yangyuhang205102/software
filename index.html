<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智慧校园公共设施管理系统</title>
  <!-- 引入 Ant Design 样式 -->
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/antd/5.12.8/antd.min.css">
  <style>
    /* 全局样式 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
    }

    /* 登录/注册页面通用样式 */
    .auth-page {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #f5f5f5;
    }
    .auth-card {
      width: 400px;
      padding: 32px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }
    .auth-title {
      text-align: center;
      font-size: 24px;
      font-weight: 500;
      margin-bottom: 24px;
      color: #001529;
    }
    .auth-form .form-item {
      margin-bottom: 16px;
    }
    .auth-form label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: #333;
    }
    .auth-form input, .auth-form select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      font-size: 14px;
    }
    .auth-form input:focus, .auth-form select:focus {
      outline: none;
      border-color: #1890ff;
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
    }
    /* 身份选择单选框样式 */
    .radio-group {
      display: flex;
      gap: 20px;
      padding: 8px 0;
      flex-wrap: wrap;
    }
    .radio-item {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }
    .radio-item input {
      width: auto;
      margin: 0;
    }
    .auth-btn {
      width: 100%;
      padding: 10px;
      background: #1890ff;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
      margin-bottom: 16px;
    }
    .auth-btn:hover {
      background: #40a9ff;
    }
    .auth-error {
      color: #ff4d4f;
      font-size: 12px;
      margin-bottom: 16px;
      text-align: center;
      display: none;
    }
    .auth-tip {
      text-align: center;
      font-size: 14px;
      color: #666;
    }
    .auth-switch {
      color: #1890ff;
      cursor: pointer;
      text-decoration: none;
    }
    .auth-switch:hover {
      color: #40a9ff;
      text-decoration: underline;
    }

    /* 导航头部样式 */
    .nav-header {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 999;
      width: 100%;
      height: 64px;
      background: #001529;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      display: none; /* 初始隐藏，登录后显示 */
    }
    .logo {
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      white-space: nowrap;
    }

    /* 导航菜单样式 */
    .nav-menu {
      display: flex;
      margin: 0 20px;
      flex: 1;
      max-width: 600px;
    }
    .menu-item {
      color: #fff;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 16px;
      height: 64px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .menu-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    .menu-item.active {
      background: #1890ff;
    }
    .menu-item svg {
      width: 16px;
      height: 16px;
      fill: #fff;
    }
    /* 管理员专属菜单默认隐藏 */
    .admin-menu {
      display: none;
    }

    /* 退出按钮样式 */
    .logout-btn {
      background: #1890ff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .logout-btn:hover {
      background: #40a9ff;
    }
    .logout-btn svg {
      width: 16px;
      height: 16px;
      fill: #fff;
    }

    /* 主内容区样式 */
    .main-content {
      margin-top: 84px;
      padding: 24px;
      background: #fff;
      margin-left: 24px;
      margin-right: 24px;
      border-radius: 8px;
      min-height: 500px;
      display: none; /* 初始隐藏，登录后显示 */
    }
    .page-title {
      font-size: 20px;
      font-weight: 500;
      margin-bottom: 20px;
    }
    /* 添加用户按钮样式 */
    .add-user-btn {
      padding: 8px 16px;
      background: #52c41a;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 16px;
    }
    .add-user-btn:hover {
      background: #73d13d;
    }

    /* 通用表格样式 */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .data-table th {
      background: #fafafa;
      font-weight: 500;
      color: #333;
    }
    .data-table th, .data-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #f0f0f0;
    }
    .data-table tr:hover {
      background: #f9f9f9;
    }

    /* 状态标签样式 */
    .status-tag {
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
    }
    .status-normal {
      background: #f0f9ff;
      color: #1890ff;
    }
    .status-pending {
      background: #fff7e6;
      color: #faad14;
    }
    .status-broken {
      background: #fff2f0;
      color: #ff4d4f;
    }

    /* 操作按钮样式 */
    .operate-btn {
      padding: 4px 8px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      margin-right: 8px;
    }
    .edit-btn {
      background: #e6f7ff;
      color: #1890ff;
    }
    .delete-btn {
      background: #fff2f0;
      color: #ff4d4f;
    }
    .repair-btn {
      background: #fff7e6;
      color: #faad14;
    }
    .save-btn {
      background: #f6ffed;
      color: #52c41a;
    }

    /* 弹窗样式（添加/编辑用户） */
    .modal-mask {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      display: none;
    }
    .modal-card {
      width: 400px;
      padding: 24px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }
    .modal-title {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 16px;
      color: #333;
    }
    .modal-form .form-item {
      margin-bottom: 16px;
    }
    .modal-form label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .modal-btn-group {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }
    .modal-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
    }
    .confirm-btn {
      background: #1890ff;
      color: #fff;
    }
    .cancel-btn {
      background: #f5f5f5;
      color: #666;
    }
  </style>
</head>
<body>
  <!-- 登录页面（默认显示） -->
  <div class="auth-page" id="login-page">
    <div class="auth-card">
      <div class="auth-title">智慧校园公共设施管理系统</div>
      <div class="auth-error" id="login-error">用户名或密码错误</div>
      <form class="auth-form" id="login-form">
        <div class="form-item">
          <label for="login-username">用户名</label>
          <input type="text" id="login-username" placeholder="请输入用户名" required>
        </div>
        <div class="form-item">
          <label for="login-password">密码</label>
          <input type="password" id="login-password" placeholder="请输入密码" required>
        </div>
        <!-- 登录身份选择：管理员/老师/学生 -->
        <div class="form-item">
          <label>登录身份</label>
          <div class="radio-group">
            <div class="radio-item">
              <input type="radio" name="login-type" id="login-admin" value="admin" required>
              <label for="login-admin">管理员</label>
            </div>
            <div class="radio-item">
              <input type="radio" name="login-type" id="login-teacher" value="teacher">
              <label for="login-teacher">老师</label>
            </div>
            <div class="radio-item">
              <input type="radio" name="login-type" id="login-student" value="student">
              <label for="login-student">学生</label>
            </div>
          </div>
        </div>
        <button type="submit" class="auth-btn">登录</button>
        <div class="auth-tip">
          还没有账号？<span class="auth-switch" id="to-register">立即注册</span>
        </div>
      </form>
    </div>
  </div>

  <!-- 注册页面（初始隐藏） -->
  <div class="auth-page" id="register-page" style="display: none;">
    <div class="auth-card">
      <div class="auth-title">用户注册</div>
      <div class="auth-error" id="register-error">注册失败，请检查信息</div>
      <form class="auth-form" id="register-form">
        <div class="form-item">
          <label for="reg-username">用户名</label>
          <input type="text" id="reg-username" placeholder="请输入用户名（3-16位）" required>
        </div>
        <div class="form-item">
          <label for="reg-password">密码</label>
          <input type="password" id="reg-password" placeholder="请输入密码（6-16位）" required>
        </div>
        <div class="form-item">
          <label for="reg-repassword">确认密码</label>
          <input type="password" id="reg-repassword" placeholder="请再次输入密码" required>
        </div>
        <div class="form-item">
          <label for="reg-phone">联系电话</label>
          <input type="tel" id="reg-phone" placeholder="请输入联系电话" required>
        </div>
        <!-- 注册身份选择：仅老师/学生 -->
        <div class="form-item">
          <label>用户身份</label>
          <div class="radio-group">
            <div class="radio-item">
              <input type="radio" name="reg-type" id="reg-teacher" value="teacher" required>
              <label for="reg-teacher">老师</label>
            </div>
            <div class="radio-item">
              <input type="radio" name="reg-type" id="reg-student" value="student">
              <label for="reg-student">学生</label>
            </div>
          </div>
        </div>
        <!-- 新增性别字段 -->
        <div class="form-item">
          <label for="reg-gender">性别</label>
          <select id="reg-gender" required>
            <option value="">请选择性别</option>
            <option value="男">男</option>
            <option value="女">女</option>
            <option value="其他">其他</option>
          </select>
        </div>
        <button type="submit" class="auth-btn">注册</button>
        <div class="auth-tip">
          已有账号？<span class="auth-switch" id="to-login">立即登录</span>
        </div>
      </form>
    </div>
  </div>

  <!-- 系统主页面（初始隐藏） -->
  <header class="nav-header" id="nav-header">
    <div class="logo">智慧校园公共设施管理系统</div>

    <!-- 导航菜单 -->
    <div class="nav-menu">
      <a id="menu-facility" class="menu-item active" href="javascript:;">
        <svg viewBox="64 64 896 896" focusable="false">
          <path d="M946.5 505L538.9 161.2c-14.2-12.2-35-12.2-49.2 0L77.5 505a63.9 63.9 0 0 0-18.8 46c.4 35.2 29.7 63.6 65 63.6h42.5V908c0 17.7 14.2 32 31.9 32H448V714h112v196h265.4c17.7 0 32-14.3 32-32V614.7h41.3c35.2 0 64.7-28.4 65-63.6.1-7.8-1.3-15.5-4.1-22.9zM512 512c79.5 0 144-64.5 144-144s-64.5-144-144-144-144 64.5-144 144 64.5 144 144 144zm0-320c105.9 0 192 86.1 192 192s-86.1 192-192 192-192-86.1-192-192 86.1-192 192-192z"/>
        </svg>
        设施列表
      </a>
      <a id="menu-add" class="menu-item" href="javascript:;">
        <svg viewBox="64 64 896 896" focusable="false">
          <path d="M909.9 854.5L649.4 594c-12.5-12.5-32.8-12.5-45.3 0L420.7 725.7l-73.2-73.2c-12.5-12.5-32.8-12.5-45.3 0L114.1 759.7c-12.5 12.5-12.5 32.8 0 45.3l278.6 278.6c12.5 12.5 32.8 12.5 45.3 0l424.4-424.4c12.5-12.5 12.5-32.8 0-45.3zM266.3 883.6L153 770.3l145.5-145.5 42.4 42.4-78.1 78.1-42.4-42.4L195.4 650l145.5-145.5 213.2 213.2-294.4 294.4-42.4-42.4zm532.3-379.2L671.7 424l-136.2 136.2 42.4 42.4 93.8-93.8 42.4 42.4 196.4-196.4-136.2-136.2-196.4 196.4-42.4-42.4-93.8 93.8-42.4-42.4L352.3 284.7l136.2-136.2 424.4 424.4-136.2 136.2z"/>
        </svg>
        添加设施
      </a>
      <a id="menu-repair" class="menu-item" href="javascript:;">
        <svg viewBox="64 64 896 896" focusable="false">
          <path d="M878 256H728v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H146c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h732c17.7 0 32-14.3 32-32V288c0-17.7-14.3-32-32-32zM664 888H360c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h304c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8zm0-168H360c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h304c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8zm0-168H360c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h304c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8z"/>
        </svg>
        报修管理
      </a>
      <!-- 管理员专属：用户管理菜单 -->
      <a id="menu-user" class="menu-item admin-menu" href="javascript:;">
        <svg viewBox="64 64 896 896" focusable="false">
          <path d="M878 256H728v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H146c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h732c17.7 0 32-14.3 32-32V288c0-17.7-14.3-32-32-32zM664 888H360c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h304c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8zm0-168H360c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h304c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8zm0-168H360c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h304c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8z"/>
        </svg>
        用户管理
      </a>
    </div>

    <button id="logout-btn" class="logout-btn">
      <svg viewBox="64 64 896 896" focusable="false">
        <path d="M858.5 763.6a374 374 0 0 0-80.6-119.5 375.63 375.63 0 0 0-119.5-80.6c-4.8-.8-9.6-1.2-14.3-1.2H512c-4.7 0-9.5.4-14.3 1.2a375.63 375.63 0 0 0-119.5 80.6 374 374 0 0 0-80.6 119.5c-.8 4.8-1.2 9.6-1.2 14.3v42.8c0 27.6 22.4 50 50 50h420c27.6 0 50-22.4 50-50v-42.8c.1-4.7-.3-9.5-1.1-14.3zM512 512c79.5 0 144-64.5 144-144s-64.5-144-144-144-144 64.5-144 144 64.5 144 144 144zm0-320c105.9 0 192 86.1 192 192s-86.1 192-192 192-192-86.1-192-192 86.1-192 192-192z"/>
      </svg>
      退出登录
    </button>
  </header>

  <!-- 主内容区 -->
  <main class="main-content" id="main-content">
    <div class="page-title" id="page-title">设施列表</div>
    <div id="page-content">
      <!-- 初始加载设施列表表格 -->
      <table class="data-table">
        <thead>
          <tr>
            <th>序号</th>
            <th>设施名称</th>
            <th>设施类型</th>
            <th>安装位置</th>
            <th>投入使用时间</th>
            <th>状态</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>直饮水机</td>
            <td>饮水设备</td>
            <td>教学楼A区1楼大厅</td>
            <td>2023-09-01</td>
            <td><span class="status-tag status-normal">正常</span></td>
            <td>
              <button class="operate-btn edit-btn">编辑</button>
              <button class="operate-btn repair-btn">报修</button>
            </td>
          </tr>
          <tr>
            <td>2</td>
            <td>中央空调</td>
            <td>制冷设备</td>
            <td>图书馆3楼阅览区</td>
            <td>2022-06-15</td>
            <td><span class="status-tag status-pending">待维修</span></td>
            <td>
              <button class="operate-btn edit-btn">编辑</button>
              <button class="operate-btn delete-btn">删除</button>
            </td>
          </tr>
          <tr>
            <td>3</td>
            <td>LED路灯</td>
            <td>照明设备</td>
            <td>操场西侧跑道旁</td>
            <td>2024-03-20</td>
            <td><span class="status-tag status-normal">正常</span></td>
            <td>
              <button class="operate-btn edit-btn">编辑</button>
              <button class="operate-btn repair-btn">报修</button>
            </td>
          </tr>
          <tr>
            <td>4</td>
            <td>多媒体投影仪</td>
            <td>教学设备</td>
            <td>教学楼B区205教室</td>
            <td>2021-09-01</td>
            <td><span class="status-tag status-broken">已损坏</span></td>
            <td>
              <button class="operate-btn edit-btn">编辑</button>
              <button class="operate-btn delete-btn">删除</button>
            </td>
          </tr>
          <tr>
            <td>5</td>
            <td>自动售货机</td>
            <td>便民设备</td>
            <td>学生公寓1号楼1楼</td>
            <td>2023-11-10</td>
            <td><span class="status-tag status-normal">正常</span></td>
            <td>
              <button class="operate-btn edit-btn">编辑</button>
              <button class="operate-btn repair-btn">报修</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <!-- 添加/编辑用户弹窗 -->
  <div class="modal-mask" id="user-modal">
    <div class="modal-card">
      <div class="modal-title" id="modal-title">添加用户</div>
      <form class="modal-form" id="user-form">
        <input type="hidden" id="user-id" value="">
        <div class="form-item">
          <label for="modal-username">用户名</label>
          <input type="text" id="modal-username" placeholder="请输入用户名" required>
        </div>
        <div class="form-item">
          <label for="modal-password">密码</label>
          <input type="password" id="modal-password" placeholder="请输入密码（编辑时留空则不修改）">
        </div>
        <div class="form-item">
          <label for="modal-phone">联系电话</label>
          <input type="tel" id="modal-phone" placeholder="请输入联系电话" required>
        </div>
        <div class="form-item">
          <label>用户身份</label>
          <div class="radio-group">
            <div class="radio-item">
              <input type="radio" name="modal-type" id="modal-teacher" value="teacher" required>
              <label for="modal-teacher">老师</label>
            </div>
            <div class="radio-item">
              <input type="radio" name="modal-type" id="modal-student" value="student">
              <label for="modal-student">学生</label>
            </div>
          </div>
        </div>
        <div class="form-item">
          <label for="modal-gender">性别</label>
          <select id="modal-gender" required>
            <option value="">请选择性别</option>
            <option value="男">男</option>
            <option value="女">女</option>
            <option value="其他">其他</option>
          </select>
        </div>
        <div class="modal-btn-group">
          <button type="button" class="modal-btn cancel-btn" id="cancel-btn">取消</button>
          <button type="submit" class="modal-btn confirm-btn">保存</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // 1. 初始化用户数据（管理员默认账号：admin/123456）
    if (!localStorage.getItem('registered_users')) {
      localStorage.setItem('registered_users', JSON.stringify([
        { id: 1, username: 'admin', password: '123456', phone: '13800138000', userType: 'admin', gender: '男' }
      ]));
    }

    // 2. 定义页面内容配置
    const pageConfig = {
      facility: {
        title: '设施列表',
        content: `
          <table class="data-table">
            <thead>
              <tr>
                <th>序号</th>
                <th>设施名称</th>
                <th>设施类型</th>
                <th>安装位置</th>
                <th>投入使用时间</th>
                <th>状态</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td>直饮水机</td>
                <td>饮水设备</td>
                <td>教学楼A区1楼大厅</td>
                <td>2023-09-01</td>
                <td><span class="status-tag status-normal">正常</span></td>
                <td>
                  <button class="operate-btn edit-btn">编辑</button>
                  <button class="operate-btn repair-btn">报修</button>
                </td>
              </tr>
              <tr>
                <td>2</td>
                <td>中央空调</td>
                <td>制冷设备</td>
                <td>图书馆3楼阅览区</td>
                <td>2022-06-15</td>
                <td><span class="status-tag status-pending">待维修</span></td>
                <td>
                  <button class="operate-btn edit-btn">编辑</button>
                  <button class="operate-btn delete-btn">删除</button>
                </td>
              </tr>
              <tr>
                <td>3</td>
                <td>LED路灯</td>
                <td>照明设备</td>
                <td>操场西侧跑道旁</td>
                <td>2024-03-20</td>
                <td><span class="status-tag status-normal">正常</span></td>
                <td>
                  <button class="operate-btn edit-btn">编辑</button>
                  <button class="operate-btn repair-btn">报修</button>
                </td>
              </tr>
              <tr>
                <td>4</td>
                <td>多媒体投影仪</td>
                <td>教学设备</td>
                <td>教学楼B区205教室</td>
                <td>2021-09-01</td>
                <td><span class="status-tag status-broken">已损坏</span></td>
                <td>
                  <button class="operate-btn edit-btn">编辑</button>
                  <button class="operate-btn delete-btn">删除</button>
                </td>
              </tr>
              <tr>
                <td>5</td>
                <td>自动售货机</td>
                <td>便民设备</td>
                <td>学生公寓1号楼1楼</td>
                <td>2023-11-10</td>
                <td><span class="status-tag status-normal">正常</span></td>
                <td>
                  <button class="operate-btn edit-btn">编辑</button>
                  <button class="operate-btn repair-btn">报修</button>
                </td>
              </tr>
            </tbody>
          </table>
        `
      },
      add: {
        title: '添加设施',
        content: `
          <form>
            <div style="margin-bottom: 16px;">
              <label style="display: block; margin-bottom: 8px;">设施名称：</label>
              <input type="text" placeholder="请输入设施名称" style="padding: 8px; width: 300px; border: 1px solid #d9d9d9; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 16px;">
              <label style="display: block; margin-bottom: 8px;">设施类型：</label>
              <select style="padding: 8px; width: 300px; border: 1px solid #d9d9d9; border-radius: 4px;">
                <option>饮水设备</option>
                <option>制冷设备</option>
                <option>照明设备</option>
                <option>教学设备</option>
                <option>便民设备</option>
              </select>
            </div>
            <div style="margin-bottom: 16px;">
              <label style="display: block; margin-bottom: 8px;">安装位置：</label>
              <input type="text" placeholder="请输入安装位置" style="padding: 8px; width: 300px; border: 1px solid #d9d9d9; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 16px;">
              <label style="display: block; margin-bottom: 8px;">投入使用时间：</label>
              <input type="date" style="padding: 8px; width: 300px; border: 1px solid #d9d9d9; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 16px;">
              <label style="display: block; margin-bottom: 8px;">初始状态：</label>
              <select style="padding: 8px; width: 300px; border: 1px solid #d9d9d9; border-radius: 4px;">
                <option>正常</option>
                <option>待维修</option>
                <option>已损坏</option>
              </select>
            </div>
            <button type="button" style="background: #1890ff; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">提交</button>
          </form>
        `
      },
      repair: {
        title: '报修管理',
        content: `
          <table class="data-table">
            <thead>
              <tr style="background: #fafafa;">
                <th>工单编号</th>
                <th>设施名称</th>
                <th>设施类型</th>
                <th>报修人</th>
                <th>报修时间</th>
                <th>状态</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>BX20251205001</td>
                <td>图书馆空调</td>
                <td>制冷设备</td>
                <td>张三</td>
                <td>2025-12-05 09:20</td>
                <td><span class="status-tag status-pending">待处理</span></td>
                <td>
                  <button class="operate-btn edit-btn">处理</button>
                  <button class="operate-btn delete-btn">关闭</button>
                </td>
              </tr>
              <tr>
                <td>BX20251205002</td>
                <td>教学楼B区电灯</td>
                <td>照明设备</td>
                <td>李四</td>
                <td>2025-12-05 10:15</td>
                <td><span class="status-tag status-normal">维修中</span></td>
                <td>
                  <button class="operate-btn edit-btn">完成</button>
                  <button class="operate-btn repair-btn">派单</button>
                </td>
              </tr>
              <tr>
                <td>BX20251204001</td>
                <td>多媒体投影仪</td>
                <td>教学设备</td>
                <td>王五</td>
                <td>2025-12-04 14:30</td>
                <td><span class="status-tag status-broken">已驳回</span></td>
                <td>
                  <button class="operate-btn edit-btn">重新提交</button>
                  <button class="operate-btn delete-btn">删除</button>
                </td>
              </tr>
            </tbody>
          </table>
        `
      },
      user: {
        title: '用户管理',
        content: function() {
          // 动态生成用户管理页面（含添加按钮+用户表格）
          const users = JSON.parse(localStorage.getItem('registered_users') || '[]');
          let html = `<button class="add-user-btn" id="add-user-btn">添加用户</button>`;
          html += `
            <table class="data-table">
              <thead>
                <tr>
                  <th>用户ID</th>
                  <th>用户名</th>
                  <th>联系电话</th>
                  <th>身份</th>
                  <th>性别</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
          `;
          users.forEach(user => {
            if (user.userType !== 'admin') { // 不显示管理员自身
              html += `
                <tr data-id="${user.id}">
                  <td>${user.id}</td>
                  <td>${user.username}</td>
                  <td>${user.phone}</td>
                  <td>${user.userType === 'teacher' ? '老师' : '学生'}</td>
                  <td>${user.gender}</td>
                  <td>
                    <button class="operate-btn edit-btn edit-user-btn">编辑</button>
                    <button class="operate-btn delete-btn delete-user-btn">删除</button>
                  </td>
                </tr>
              `;
            }
          });
          html += `
              </tbody>
            </table>
          `;
          return html;
        }
      }
    };

    // 3. DOM元素获取
    const loginPage = document.getElementById('login-page');
    const registerPage = document.getElementById('register-page');
    const navHeader = document.getElementById('nav-header');
    const mainContent = document.getElementById('main-content');
    const userModal = document.getElementById('user-modal');
    
    // 登录相关元素
    const loginForm = document.getElementById('login-form');
    const loginError = document.getElementById('login-error');
    const loginUsername = document.getElementById('login-username');
    const loginPassword = document.getElementById('login-password');
    const loginTypeRadios = document.querySelectorAll('input[name="login-type"]');
    
    // 注册相关元素
    const registerForm = document.getElementById('register-form');
    const registerError = document.getElementById('register-error');
    const regUsername = document.getElementById('reg-username');
    const regPassword = document.getElementById('reg-password');
    const regRepassword = document.getElementById('reg-repassword');
    const regPhone = document.getElementById('reg-phone');
    const regTypeRadios = document.querySelectorAll('input[name="reg-type"]');
    const regGender = document.getElementById('reg-gender');
    
    // 切换按钮
    const toRegister = document.getElementById('to-register');
    const toLogin = document.getElementById('to-login');
    
    // 菜单元素
    const menuItems = document.querySelectorAll('.menu-item');
    const adminMenu = document.querySelector('.admin-menu');
    const logoutBtn = document.getElementById('logout-btn');
    const pageTitle = document.getElementById('page-title');
    const pageContent = document.getElementById('page-content');
    
    // 弹窗相关元素
    const modalTitle = document.getElementById('modal-title');
    const userForm = document.getElementById('user-form');
    const userIdInput = document.getElementById('user-id');
    const modalUsername = document.getElementById('modal-username');
    const modalPassword = document.getElementById('modal-password');
    const modalPhone = document.getElementById('modal-phone');
    const modalTypeRadios = document.querySelectorAll('input[name="modal-type"]');
    const modalGender = document.getElementById('modal-gender');
    const cancelBtn = document.getElementById('cancel-btn');

    // 4. 登录/注册页面切换逻辑
    toRegister.addEventListener('click', function() {
      loginPage.style.display = 'none';
      registerPage.style.display = 'flex';
      registerError.style.display = 'none';
      // 默认选中老师身份+男
      document.getElementById('reg-teacher').checked = true;
      regGender.value = '男';
    });

    toLogin.addEventListener('click', function() {
      registerPage.style.display = 'none';
      loginPage.style.display = 'flex';
      loginError.style.display = 'none';
      // 默认选中管理员身份
      document.getElementById('login-admin').checked = true;
    });

    // 5. 权限控制：根据登录身份显示/隐藏菜单
    function setMenuPermission(loginType) {
      // 管理员：显示所有菜单（含用户管理），老师/学生：隐藏添加设施+用户管理
      adminMenu.style.display = loginType === 'admin' ? 'flex' : 'none';
      document.getElementById('menu-add').style.display = loginType === 'student' ? 'none' : 'flex';
    }

    // 6. 初始化检查登录状态
    function checkLoginStatus() {
      const token = localStorage.getItem('token');
      const loginType = localStorage.getItem('login_type');
      if (token && loginType) {
        // 已登录：显示系统页面，设置菜单权限
        loginPage.style.display = 'none';
        registerPage.style.display = 'none';
        navHeader.style.display = 'flex';
        mainContent.style.display = 'block';
        setMenuPermission(loginType);
        // 默认显示设施列表
        renderPage('facility');
      } else {
        // 未登录：显示登录页
        loginPage.style.display = 'flex';
        registerPage.style.display = 'none';
        navHeader.style.display = 'none';
        mainContent.style.display = 'none';
      }
    }

    // 7. 页面渲染函数
    function renderPage(pageKey) {
      // 重置菜单激活状态
      menuItems.forEach(item => item.classList.remove('active'));
      document.getElementById(`menu-${pageKey}`).classList.add('active');
      
      // 设置页面标题和内容
      pageTitle.textContent = pageConfig[pageKey].title;
      pageContent.innerHTML = typeof pageConfig[pageKey].content === 'function' 
        ? pageConfig[pageKey].content() 
        : pageConfig[pageKey].content;
      
      // 绑定用户管理页面的按钮事件
      if (pageKey === 'user') {
        bindUserManageEvents();
      }
    }

    // 8. 绑定用户管理相关事件
    function bindUserManageEvents() {
      // 添加用户按钮
      document.getElementById('add-user-btn')?.addEventListener('click', function() {
        openUserModal();
      });
      
      // 编辑用户按钮
      document.querySelectorAll('.edit-user-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tr = this.closest('tr');
          const userId = tr.dataset.id;
          openUserModal(userId);
        });
      });
      
      // 删除用户按钮
      document.querySelectorAll('.delete-user-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tr = this.closest('tr');
          const userId = parseInt(tr.dataset.id);
          const username = tr.querySelector('td:nth-child(2)').textContent;
          
          if (confirm(`确定要删除用户【${username}】吗？`)) {
            let users = JSON.parse(localStorage.getItem('registered_users') || '[]');
            users = users.filter(user => user.id !== userId);
            localStorage.setItem('registered_users', JSON.stringify(users));
            // 重新渲染用户管理页面
            renderPage('user');
            alert('用户删除成功！');
          }
        });
      });
    }

    // 9. 打开用户弹窗（添加/编辑）
    function openUserModal(userId = null) {
      userModal.style.display = 'flex';
      // 清空表单
      userForm.reset();
      
      if (userId) {
        // 编辑模式
        modalTitle.textContent = '编辑用户';
        const users = JSON.parse(localStorage.getItem('registered_users') || '[]');
        const user = users.find(u => u.id === parseInt(userId));
        if (user) {
          userIdInput.value = user.id;
          modalUsername.value = user.username;
          modalPhone.value = user.phone;
          modalGender.value = user.gender;
          // 选中身份
          if (user.userType === 'teacher') {
            document.getElementById('modal-teacher').checked = true;
          } else {
            document.getElementById('modal-student').checked = true;
          }
          // 密码框置空（编辑时留空不修改）
          modalPassword.placeholder = '留空则不修改密码';
        }
      } else {
        // 添加模式
        modalTitle.textContent = '添加用户';
        userIdInput.value = '';
        // 默认选中老师+男
        document.getElementById('modal-teacher').checked = true;
        modalGender.value = '男';
        modalPassword.placeholder = '请输入密码（6-16位）';
      }
    }

    // 10. 登录表单提交事件
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const username = loginUsername.value.trim();
      const password = loginPassword.value.trim();
      let loginType = '';
      for (const radio of loginTypeRadios) {
        if (radio.checked) {
          loginType = radio.value;
          break;
        }
      }
      
      // 验证登录信息
      const users = JSON.parse(localStorage.getItem('registered_users') || '[]');
      const user = users.find(u => u.username === username && u.password === password && u.userType === loginType);
      
      if (user || (username === 'admin' && password === '123456' && loginType === 'admin')) {
        // 登录成功
        localStorage.setItem('token', 'fake-token-' + Date.now());
        localStorage.setItem('login_type', loginType);
        loginError.style.display = 'none';
        alert(`登录成功！您的身份是：${loginType === 'admin' ? '管理员' : loginType === 'teacher' ? '老师' : '学生'}`);
        checkLoginStatus();
      } else {
        // 登录失败
        loginError.textContent = '用户名/密码/身份不匹配';
        loginError.style.display = 'block';
      }
    });

    // 11. 注册表单提交事件
    registerForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const username = regUsername.value.trim();
      const password = regPassword.value.trim();
      const repassword = regRepassword.value.trim();
      const phone = regPhone.value.trim();
      let regType = '';
      for (const radio of regTypeRadios) {
        if (radio.checked) {
          regType = radio.value;
          break;
        }
      }
      const gender = regGender.value;
      
      // 表单验证
      if (username.length < 3 || username.length > 16) {
        registerError.textContent = '用户名长度需在3-16位之间';
        registerError.style.display = 'block';
        return;
      }
      if (password.length < 6 || password.length > 16) {
        registerError.textContent = '密码长度需在6-16位之间';
        registerError.style.display = 'block';
        return;
      }
      if (password !== repassword) {
        registerError.textContent = '两次输入的密码不一致';
        registerError.style.display = 'block';
        return;
      }
      if (!/^1[3-9]\d{9}$/.test(phone)) {
        registerError.textContent = '请输入有效的手机号码';
        registerError.style.display = 'block';
        return;
      }
      if (!gender) {
        registerError.textContent = '请选择性别';
        registerError.style.display = 'block';
        return;
      }
      // 检查用户名是否重复
      const users = JSON.parse(localStorage.getItem('registered_users') || '[]');
      if (users.some(u => u.username === username)) {
        registerError.textContent = '用户名已存在，请更换';
        registerError.style.display = 'block';
        return;
      }
      
      // 注册成功：生成用户ID，存储信息
      const newUserId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 2; // 管理员ID=1
      const newUser = {
        id: newUserId,
        username,
        password,
        phone,
        userType: regType,
        gender
      };
      users.push(newUser);
      localStorage.setItem('registered_users', JSON.stringify(users));
      
      alert(`注册成功！您的身份是：${regType === 'teacher' ? '老师' : '学生'}`);
      toLogin.click();
      loginUsername.value = username;
    });

    // 12. 用户表单提交事件（添加/编辑）
    userForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const userId = userIdInput.value;
      const username = modalUsername.value.trim();
      const password = modalPassword.value.trim();
      const phone = modalPhone.value.trim();
      let userType = '';
      for (const radio of modalTypeRadios) {
        if (radio.checked) {
          userType = radio.value;
          break;
        }
      }
      const gender = modalGender.value;
      
      // 验证
      if (username.length < 3 || username.length > 16) {
        alert('用户名长度需在3-16位之间');
        return;
      }
      if (!userId && !password) { // 添加用户必须填密码
        alert('请输入密码');
        return;
      }
      if (password && (password.length < 6 || password.length > 16)) {
        alert('密码长度需在6-16位之间');
        return;
      }
      if (!/^1[3-9]\d{9}$/.test(phone)) {
        alert('请输入有效的手机号码');
        return;
      }
      if (!gender) {
        alert('请选择性别');
        return;
      }
      
      let users = JSON.parse(localStorage.getItem('registered_users') || '[]');
      
      if (userId) {
        // 编辑用户
        const index = users.findIndex(u => u.id === parseInt(userId));
        if (index !== -1) {
          users[index].username = username;
          users[index].phone = phone;
          users[index].userType = userType;
          users[index].gender = gender;
          // 密码留空则不修改
          if (password) {
            users[index].password = password;
          }
          localStorage.setItem('registered_users', JSON.stringify(users));
          alert('用户信息编辑成功！');
        }
      } else {
        // 添加用户：检查用户名重复
        if (users.some(u => u.username === username)) {
          alert('用户名已存在，请更换');
          return;
        }
        const newUserId = Math.max(...users.map(u => u.id)) + 1;
        users.push({
          id: newUserId,
          username,
          password,
          phone,
          userType,
          gender
        });
        localStorage.setItem('registered_users', JSON.stringify(users));
        alert('用户添加成功！');
      }
      
      // 关闭弹窗，重新渲染用户管理页面
      userModal.style.display = 'none';
      renderPage('user');
    });

    // 13. 取消按钮事件
    cancelBtn.addEventListener('click', function() {
      userModal.style.display = 'none';
    });

    // 14. 导航菜单点击事件
    menuItems.forEach(item => {
      item.addEventListener('click', function() {
        const pageKey = this.id.split('-')[1];
        renderPage(pageKey);
      });
    });

    // 15. 退出登录事件
    logoutBtn.addEventListener('click', function() {
      localStorage.removeItem('token');
      localStorage.removeItem('login_type');
      alert('退出登录成功！');
      checkLoginStatus();
    });

    // 16. 表格通用操作按钮事件
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('operate-btn') && !e.target.classList.contains('edit-user-btn') && !e.target.classList.contains('delete-user-btn')) {
        const btnType = e.target.classList[1].split('-')[0];
        const facilityName = e.target.closest('tr')?.querySelector('td:nth-child(2)')?.textContent;
        if (facilityName) {
          if (btnType === 'edit') {
            alert(`即将编辑【${facilityName}】的信息`);
          } else if (btnType === 'delete') {
            if (confirm(`确定要删除【${facilityName}】的记录吗？`)) {
              alert(`已删除【${facilityName}】的记录`);
            }
          } else if (btnType === 'repair') {
            alert(`即将提交【${facilityName}】的报修申请`);
          }
        }
      }
    });

    // 页面加载时初始化
    window.onload = function() {
      checkLoginStatus();
      // 默认选中登录页的管理员身份
      document.getElementById('login-admin').checked = true;
    };
  </script>
</body>
</html>
